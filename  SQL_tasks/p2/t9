SELECT DISTINCT fst.COMPANY, m_snd.WARE, p_snd.WARE, p_fst.WARE 
FROM MANUFACTURER fst
JOIN MANUFACTURER snd ON fst.COMPANY = snd.COMPANY
JOIN PRODUCT p_fst ON fst.RECIPE_ID = p_fst.RECIPE_ID
JOIN MATERIAL m_fst ON fst.RECIPE_ID = m_fst.RECIPE_ID
JOIN PRODUCT p_snd ON (snd.RECIPE_ID = p_snd.RECIPE_ID AND m_fst.WARE = p_snd.WARE)
LEFT JOIN MATERIAL m_snd ON snd.RECIPE_ID = m_snd.RECIPE_ID
ORDER BY fst.COMPANY, p_snd.WARE ASC;