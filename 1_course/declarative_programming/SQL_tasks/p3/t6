SELECT M.COMPANY AS COMPANY,
       COUNT(DISTINCT P.WARE) AS PRODUCING,
       COUNT(DISTINCT MA.WARE) AS CONSUMING
FROM MANUFACTURER M
LEFT JOIN PRODUCT P
    ON P.RECIPE_ID = M.RECIPE_ID
LEFT JOIN MATERIAL MA
    ON MA.RECIPE_ID = P.RECIPE_ID
GROUP BY M.COMPANY
HAVING COUNT(DISTINCT P.WARE) > COUNT(DISTINCT MA.WARE)
ORDER BY M.COMPANY ASC;