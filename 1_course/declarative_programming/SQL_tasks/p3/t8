SELECT M.COMPANY AS COMPANY, group_concat(DISTINCT P.WARE) AS PRODUCTS, group_concat(DISTINCT C.CLASS) AS CLASSES
FROM MANUFACTURER M
LEFT JOIN PRODUCT P
ON M.RECIPE_ID = P.RECIPE_ID
INNER JOIN CATEGORY C
ON P.WARE = C.WARE
WHERE C.CLASS IN ("Fuel", "Food", "Mineral", "Chemicals")
GROUP BY COMPANY
HAVING count(DISTINCT C.CLASS) >= 4 and count(DISTINCT P.WARE) >= 4